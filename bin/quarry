<?php

require_once __DIR__ . '/../vendor/autoload.php';

use Quarry\Quarry;
use Quarry\Commands\MigrateCommand;
use Quarry\Commands\MakeSchemaCommand;
use Quarry\Commands\ConnectionStatusCommand;
use Symfony\Component\Console\Application;

// Try to load configuration
$configPath = getcwd() . '/config/database.php';
if (file_exists($configPath)) {
    $config = require $configPath;
    Quarry::initialize($config);
} else {
    // Fallback: create a default SQLite configuration
    Quarry::initialize([
        'connections' => [
            'primary' => [
                'max_connections' => 5,
                'connection_config' => [
                    'database_url' => 'sqlite:///' . getcwd() . '/database.sqlite'
                ]
            ]
        ],
        'default_connection' => 'primary'
    ]);
}

$application = new Application('Quarry ORM', '0.0.1');

// Register commands
$application->add(new MigrateCommand());
$application->add(new MakeSchemaCommand());
// $application->add(new ConnectionStatusCommand());

$application->run();
